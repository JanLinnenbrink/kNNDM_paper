CVmethod_labs <- c("random", "spatial", "kNNDM", "kNNDM [tuned]")
xlabs <- c("random","regular","weak\nclustered","medium\nclustered","strong\nclustered")
lw <- 0.6
w <- 0.45
(diff_RMSE <- ggplot(outtab[outtab$methodID!=0,], aes(x=design, y=rRMSE, colour=method, linetype=method)) +
geom_boxplot(lwd=lw, width=w,position=position_dodge(0.6)) +
geom_hline(yintercept = 0, linetype="solid", alpha=0.6) +
scale_colour_manual(values = c("black", "#E69F00", "#009E73", "#009E73"),name="CV method", labels=CVmethod_labs) +
scale_linetype_manual(values=c("solid", "solid", "solid", "dashed"),name="CV method", labels=CVmethod_labs) +
scale_x_discrete(labels=xlabs) +
ylab("CV - true RMSE") +
xlab("") +
scale_y_continuous(breaks=c(-15,-10,-5,0,5,10)) +
theme_bw() +
theme(legend.position = "bottom"))
infolder
write.csv(outtab, file.path(infolder, "outtab100.csv"))
write.csv(outtab, file.path(infolder, "outtab100.csv"))
library(ggplot2)
library(ggthemes)
outtab <- read.csv(file.path(infolder, "outtab100.csv"))
CVmethod_labs <- c("random", "spatial", "kNNDM", "kNNDM [tuned]")
xlabs <- c("random","regular","weak\nclustered","medium\nclustered","strong\nclustered")
lw <- 0.6
w <- 0.45
(diff_RMSE <- ggplot(outtab[outtab$methodID!=0,], aes(x=design, y=rRMSE, colour=method, linetype=method)) +
geom_boxplot(lwd=lw, width=w,position=position_dodge(0.6)) +
geom_hline(yintercept = 0, linetype="solid", alpha=0.6) +
scale_colour_manual(values = c("black", "#E69F00", "#009E73", "#009E73"),name="CV method", labels=CVmethod_labs) +
scale_linetype_manual(values=c("solid", "solid", "solid", "dashed"),name="CV method", labels=CVmethod_labs) +
scale_x_discrete(labels=xlabs) +
ylab("CV - true RMSE") +
xlab("") +
scale_y_continuous(breaks=c(-15,-10,-5,0,5,10)) +
theme_bw() +
theme(legend.position = "bottom"))
outtab <- read.csv(file.path(infolder, "outtab100.csv"))
outtab$method <- factor(outtab$method, levels=mets)
outtab$design <- factor(outtab$design, levels=c("simpleRandom", "regular", "clusterMedium",
"clusterStrong", "clusterGapped"))
outtab$variate <- as.factor(outtab$variate)
CVmethod_labs <- c("random", "spatial", "kNNDM", "kNNDM [tuned]")
xlabs <- c("random","regular","weak\nclustered","medium\nclustered","strong\nclustered")
lw <- 0.6
w <- 0.45
(diff_RMSE <- ggplot(outtab[outtab$methodID!=0,], aes(x=design, y=rRMSE, colour=method, linetype=method)) +
geom_boxplot(lwd=lw, width=w,position=position_dodge(0.6)) +
geom_hline(yintercept = 0, linetype="solid", alpha=0.6) +
scale_colour_manual(values = c("black", "#E69F00", "#009E73", "#009E73"),name="CV method", labels=CVmethod_labs) +
scale_linetype_manual(values=c("solid", "solid", "solid", "dashed"),name="CV method", labels=CVmethod_labs) +
scale_x_discrete(labels=xlabs) +
ylab("CV - true RMSE") +
xlab("") +
scale_y_continuous(breaks=c(-15,-10,-5,0,5,10)) +
theme_bw() +
theme(legend.position = "bottom"))
k_sel <- ggplot(outtab[!is.na(outtab$k),], aes(x=k)) +
geom_histogram() +
scale_x_continuous(breaks=seq(2,20,2)) +
ylab("times selected") +
facet_wrap(~design, labeller=as_labeller(c(`clusterStrong`= "medium clustered", `clusterGapped` = "strong clustered"))) +
theme_bw()
#ggsave("figures/fig8_RMSE_diff_AGB.pdf", diff_RMSE, height = unit(4, "cm"), width=unit(6, "cm"))
#ggsave("figures/fig11_k_sel.pdf", k_sel, height=3.5, width=6)
diff_RMSE
# load AOI
aoi <- st_read("~/CrossValidation/data_sim_AGB/strata.shp") |>
st_union()
st_crs(aoi) <- st_crs(pts_sf)
# load AGB stack and response surface
AGBstack <- rast("~/CrossValidation/data_sim_AGB/AGBstack.tif")
AGB_sample <- AGBstack[[c(3:7,1)]] |>
aggregate(10)
nx <- minmax(AGB_sample)
AGB_sample <- (AGB_sample - nx[1,]) / (nx[2,] - nx[1,])
names(AGB_sample) <- c("bio1","bio5", "bio7", "bio12", "bio15", "outcome")
library("ggplot2")
library("sf")
library("CAST")
library("cowplot")
source("simulation1_virtualSpecies/code/figures_utils.R")
source("simulation1_virtualSpecies/code/sim_functions.R")
AOI <- quiet(st_read(dsn="simulation1_virtualSpecies/data/species_vdata.gpkg", layer="sampling_polygon"))[1,]
AOI_part <- st_buffer(AOI, -200000)
set.seed(10)
tpoints_rand <- sim2_samples(100, "random", AOI)
set.seed(10)
tpoints_reg <- sim2_samples(100, "sregular", AOI)
set.seed(10)
tpoints_cl <-  sim2_samples(100, "sclust", AOI)
tpoints_cl$cl <- "clustered"
tpoints_rand$cl <- "random"
tpoints_reg$cl <- "regular"
tp <- rbind(tpoints_rand, tpoints_cl)
set.seed(100)
ppoints <- st_sample(AOI, 500, type = "regular") |>
st_transform(st_crs(tpoints_rand))
set.seed(100)
k_reg <- knndm(tpoints_reg, ppoints=ppoints)
set.seed(100)
k_rand <- knndm(tpoints_rand, ppoints=ppoints)
set.seed(100)
k_clust <- knndm(tpoints_cl, k = 2,  ppoints=ppoints, maxp=0.8)
pts.size <- 1
ppts.alpha <- 0.5
base.size <- 12
Ws <- lapply(list(k_reg, k_rand,k_clust), function(x) twosamples::wass_stat(x$Gj, x$Gij))
reg_dist <- plot.knndm.integral(k_reg) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
geom_text(aes(label=paste("W=", round(Ws[[1]])), x=12^5,y=0.6), size=5, col="orange") +
xlab("r") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
rand_dist <- plot.knndm.integral(k_rand) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
geom_text(aes(label=paste("W=", round(Ws[[2]])), x=12^5,y=0.6), size=5, col="orange") +
xlab("r") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
clust_dist <- plot.knndm.integral(k_clust) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
xlab("r") +
geom_text(aes(label=paste("W=", round(Ws[[3]])), x=12^5,y=0.6), size=5, col="orange") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
legend_bottom <- get_legend(rand_dist+
guides(color = guide_legend(nrow = 1)) +
theme(legend.position = "bottom"))
pts_cl_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_cl,size=pts.size) +
scale_color_manual(values = c("blue","orange")) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
pts_reg_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_reg, size=pts.size) +
scale_color_manual(values= rainbow(10)) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
pts_rand_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_rand, size=pts.size) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
top_row <- plot_grid(pts_reg_pl, pts_rand_pl, pts_cl_pl, nrow=1)
bottom_row <- plot_grid(reg_dist, rand_dist,  clust_dist, nrow=1)
comb_pl <- plot_grid(NULL, top_row, NULL, bottom_row, NULL, legend_bottom, NULL,
nrow=7, rel_heights = c(-0.22,1, -0.42,1,-0.7,1,-0.45))
#ggsave("figures/fig1_example_ecdfs.png", comb_pl, height = 12, width=20, units="cm")
comb_pl
library("ggplot2")
library("sf")
library("CAST")
library("cowplot")
source("code/figures_utils.R")
setwd("~/git/kNNDM_paper/simulation1_virtualSpecies/")
library("ggplot2")
library("sf")
library("CAST")
library("cowplot")
source("code/figures_utils.R")
source("code/sim_functions.R")
AOI <- quiet(st_read(dsn="data/species_vdata.gpkg", layer="sampling_polygon"))[1,]
AOI_part <- st_buffer(AOI, -200000)
source("code/figures_utils.R")
setwd("~/git/kNNDM_paper/")
source("simulation1_virtualSpecies/code/figures_utils.R")
source("simulation1_virtualSpecies/code/sim_functions.R")
AOI <- quiet(st_read(dsn="data/species_vdata.gpkg", layer="sampling_polygon"))[1,]
AOI_part <- st_buffer(AOI, -200000)
AOI <- quiet(st_read(dsn="simulation1_virtualSpecies/data/species_vdata.gpkg", layer="sampling_polygon"))[1,]
AOI_part <- st_buffer(AOI, -200000)
set.seed(10)
tpoints_rand <- sim2_samples(100, "random", AOI)
set.seed(10)
tpoints_reg <- sim2_samples(100, "sregular", AOI)
set.seed(10)
tpoints_cl <-  sim2_samples(100, "sclust", AOI)
tpoints_cl$cl <- "clustered"
tpoints_rand$cl <- "random"
tpoints_reg$cl <- "regular"
tp <- rbind(tpoints_rand, tpoints_cl)
set.seed(100)
ppoints <- st_sample(AOI, 500, type = "regular") |>
st_transform(st_crs(tpoints_rand))
set.seed(100)
k_reg <- knndm(tpoints_reg, ppoints=ppoints)
set.seed(100)
k_rand <- knndm(tpoints_rand, ppoints=ppoints)
set.seed(100)
k_clust <- knndm(tpoints_cl, k = 2,  ppoints=ppoints, maxp=0.8)
pts.size <- 1
ppts.alpha <- 0.5
base.size <- 12
Ws <- lapply(list(k_reg, k_rand,k_clust), function(x) twosamples::wass_stat(x$Gj, x$Gij))
reg_dist <- plot.knndm.integral(k_reg) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
geom_text(aes(label=paste("W=", round(Ws[[1]])), x=12^5,y=0.6), size=5, col="orange") +
xlab("r") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
rand_dist <- plot.knndm.integral(k_rand) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
geom_text(aes(label=paste("W=", round(Ws[[2]])), x=12^5,y=0.6), size=5, col="orange") +
xlab("r") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
clust_dist <- plot.knndm.integral(k_clust) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
xlab("r") +
geom_text(aes(label=paste("W=", round(Ws[[3]])), x=12^5,y=0.6), size=5, col="orange") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
legend_bottom <- get_legend(rand_dist+
guides(color = guide_legend(nrow = 1)) +
theme(legend.position = "bottom"))
pts_cl_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_cl,size=pts.size) +
scale_color_manual(values = c("blue","orange")) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
pts_reg_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_reg, size=pts.size) +
scale_color_manual(values= rainbow(10)) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
pts_rand_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_rand, size=pts.size) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
top_row <- plot_grid(pts_reg_pl, pts_rand_pl, pts_cl_pl, nrow=1)
bottom_row <- plot_grid(reg_dist, rand_dist,  clust_dist, nrow=1)
comb_pl <- plot_grid(NULL, top_row, NULL, bottom_row, NULL, legend_bottom, NULL,
nrow=7, rel_heights = c(-0.22,1, -0.42,1,-0.7,1,-0.45))
#ggsave("figures/fig1_example_ecdfs.png", comb_pl, height = 12, width=20, units="cm")
comb_pl
# get mean and sd
sim_diff |>
filter(name %in% c("rmse_kndm", "rmse_nndm", "mae_kndm", "mae_nndm") & dsample == "sclust") |>
group_by(name, dsample) |>
summarise(mean = mean(value),
sd = sd(value))
library("ggplot2")
library("ggthemes")
library("cowplot")
library("dplyr")
library("tidyr")
library("forcats")
# read and process the simulation results
sim_res <- read.csv("simulation1_virtualSpecies/results/sim_res.csv")
sim_diff <- data.frame(rmse_rand = sim_res$RMSE_rand - sim_res$RMSE_surf,
rmse_spatial = sim_res$RMSE_spatial - sim_res$RMSE_surf,
rmse_nndm = sim_res$RMSE_nndm - sim_res$RMSE_surf,
rmse_kndm = sim_res$RMSE_kndm - sim_res$RMSE_surf,
r2_rand =  -1*(sim_res$R2_rand - sim_res$R2_surf),
r2_spatial= -1*(sim_res$R2_spatial - sim_res$R2_surf),
r2_nndm = -1*(sim_res$R2_nndm - sim_res$R2_surf),
r2_kndm = -1*(sim_res$R2_kndm - sim_res$R2_surf),
mae_rand = sim_res$MAE_rand - sim_res$MAE_surf,
mae_spatial = sim_res$MAE_spatial - sim_res$MAE_surf,
mae_kndm = sim_res$MAE_kndm - sim_res$MAE_surf,
mae_nndm = sim_res$MAE_nndm - sim_res$MAE_surf,
dsample = sim_res$dsample) |>
pivot_longer(!dsample) |>
mutate(distr = case_when(dsample == "sregular" ~ "Strong\nregular",
dsample == "wregular" ~ "Weak\nregular",
dsample == "random" ~ "Random",
dsample == "wclust" ~ "Weak\nclustered",
dsample == "sclust" ~ "Strong\nclustered"),
distr = as.factor(distr),
distr = fct_relevel(distr, c("Strong\nregular", "Weak\nregular", "Random",
"Weak\nclustered", "Strong\nclustered")),
CV_method = case_when(grepl("rand", name) ~ "random 10-fold",
grepl("spatial", name) ~ "spatial 10-fold",
grepl("nndm", name) ~ "NNDM LOO",
grepl("kndm", name) ~ "kNNDM 10-fold"),
CV_method = fct_relevel(CV_method, "random 10-fold",  "spatial 10-fold","NNDM LOO","kNNDM 10-fold"),
group = case_when(startsWith(name, "rmse") ~ "RMSE",
startsWith(name, "mae") ~ "MAE",
startsWith(name, "r2") ~ "R^2"))
# get mean and sd
sim_diff |>
filter(name %in% c("rmse_kndm", "rmse_nndm", "mae_kndm", "mae_nndm") & dsample == "sclust") |>
group_by(name, dsample) |>
summarise(mean = mean(value),
sd = sd(value))
library("ggplot2")
library("sf")
library("CAST")
library("cowplot")
source("simulation1_virtualSpecies/code/figures_utils.R")
source("simulation1_virtualSpecies/code/sim_functions.R")
AOI <- quiet(st_read(dsn="simulation1_virtualSpecies/data/species_vdata.gpkg", layer="sampling_polygon"))[1,]
AOI_part <- st_buffer(AOI, -200000)
set.seed(10)
tpoints_rand <- sim2_samples(100, "random", AOI)
set.seed(10)
tpoints_reg <- sim2_samples(100, "sregular", AOI)
set.seed(10)
tpoints_cl <-  sim2_samples(100, "sclust", AOI)
tpoints_cl$cl <- "clustered"
tpoints_rand$cl <- "random"
tpoints_reg$cl <- "regular"
tp <- rbind(tpoints_rand, tpoints_cl)
set.seed(100)
ppoints <- st_sample(AOI, 500, type = "regular") |>
st_transform(st_crs(tpoints_rand))
set.seed(100)
k_reg <- knndm(tpoints_reg, ppoints=ppoints)
set.seed(100)
k_rand <- knndm(tpoints_rand, ppoints=ppoints)
set.seed(100)
k_clust <- knndm(tpoints_cl, k = 2,  ppoints=ppoints, maxp=0.8)
pts.size <- 1
ppts.alpha <- 0.5
base.size <- 12
Ws <- lapply(list(k_reg, k_rand,k_clust), function(x) twosamples::wass_stat(x$Gj, x$Gij))
reg_dist <- plot.knndm.integral(k_reg) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
geom_text(aes(label=paste("W=", scales::comma(round(Ws[[1]]))), x=12^5,y=0.6), size=5, col="orange") +
xlab("r") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
rand_dist <- plot.knndm.integral(k_rand) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
geom_text(aes(label=paste("W=", scales::comma(round(Ws[[2]]))), x=12^5,y=0.6), size=5, col="orange") +
xlab("r") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
clust_dist <- plot.knndm.integral(k_clust) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
xlab("r") +
geom_text(aes(label=paste("W=", scales::comma(round(Ws[[3]]))), x=12^5,y=0.6), size=5, col="orange") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
legend_bottom <- get_legend(rand_dist+
guides(color = guide_legend(nrow = 1)) +
theme(legend.position = "bottom"))
pts_cl_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_cl,size=pts.size) +
scale_color_manual(values = c("blue","orange")) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
pts_reg_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_reg, size=pts.size) +
scale_color_manual(values= rainbow(10)) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
pts_rand_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_rand, size=pts.size) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
top_row <- plot_grid(pts_reg_pl, pts_rand_pl, pts_cl_pl, nrow=1)
bottom_row <- plot_grid(reg_dist, rand_dist,  clust_dist, nrow=1)
comb_pl <- plot_grid(NULL, top_row, NULL, bottom_row, NULL, legend_bottom, NULL,
nrow=7, rel_heights = c(-0.22,1, -0.42,1,-0.7,1,-0.45))
#ggsave("figures/fig1_example_ecdfs.png", comb_pl, height = 12, width=20, units="cm")
comb_pl
library("ggplot2")
library("sf")
library("CAST")
library("cowplot")
source("simulation1_virtualSpecies/code/figures_utils.R")
source("simulation1_virtualSpecies/code/sim_functions.R")
AOI <- quiet(st_read(dsn="simulation1_virtualSpecies/data/species_vdata.gpkg", layer="sampling_polygon"))[1,]
AOI_part <- st_buffer(AOI, -200000)
set.seed(10)
tpoints_rand <- sim2_samples(100, "random", AOI)
set.seed(10)
tpoints_reg <- sim2_samples(100, "sregular", AOI)
set.seed(10)
tpoints_cl <-  sim2_samples(100, "sclust", AOI)
tpoints_cl$cl <- "clustered"
tpoints_rand$cl <- "random"
tpoints_reg$cl <- "regular"
tp <- rbind(tpoints_rand, tpoints_cl)
set.seed(100)
ppoints <- st_sample(AOI, 500, type = "regular") |>
st_transform(st_crs(tpoints_rand))
set.seed(100)
k_reg <- knndm(tpoints_reg, ppoints=ppoints)
set.seed(100)
k_rand <- knndm(tpoints_rand, ppoints=ppoints)
set.seed(100)
k_clust <- knndm(tpoints_cl, k = 2,  ppoints=ppoints, maxp=0.8)
pts.size <- 1
ppts.alpha <- 0.5
base.size <- 12
Ws <- lapply(list(k_reg, k_rand,k_clust), function(x) twosamples::wass_stat(x$Gj, x$Gij))
reg_dist <- plot.knndm.integral(k_reg) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
geom_text(aes(label=paste("W=", scales::comma(round(Ws[[1]]))), x=12^5,y=0.6), size=5, col="orange") +
xlab("r") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
rand_dist <- plot.knndm.integral(k_rand) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
geom_text(aes(label=paste("W=", scales::comma(round(Ws[[2]]))), x=12^5,y=0.6), size=5, col="orange") +
xlab("r") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
clust_dist <- plot.knndm.integral(k_clust) +
scale_x_continuous(labels = function(x) format(x, scientific = TRUE),n.breaks = 3, limits=c(0,4*10^5)) +
xlab("r") +
geom_text(aes(label=paste("W=", scales::comma(round(Ws[[3]]))), x=12^5,y=0.6), size=5, col="orange") +
theme_bw(base_size = base.size) +
theme(aspect.ratio = 1, legend.position = NaN,plot.margin = unit(rep(0.2,4), "cm"))
legend_bottom <- get_legend(rand_dist+
guides(color = guide_legend(nrow = 1)) +
theme(legend.position = "bottom"))
pts_cl_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_cl,size=pts.size) +
scale_color_manual(values = c("blue","orange")) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
pts_reg_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_reg, size=pts.size) +
scale_color_manual(values= rainbow(10)) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
pts_rand_pl <- ggplot() +
geom_sf(data=AOI, alpha=0) +
geom_sf(data=ppoints, size=0.2, alpha=ppts.alpha) +
geom_sf(data=tpoints_rand, size=pts.size) +
scale_x_continuous(breaks=c(-8,0)) +
scale_y_continuous(breaks=c(38,42)) +
theme_bw(base_size = base.size) +
theme(legend.position = "None",
strip.text.x = element_text(size = 12),
plot.margin = unit(rep(0.2,4), "cm")) +
facet_wrap(~cl)
top_row <- plot_grid(pts_reg_pl, pts_rand_pl, pts_cl_pl, nrow=1)
bottom_row <- plot_grid(reg_dist, rand_dist,  clust_dist, nrow=1)
comb_pl <- plot_grid(NULL, top_row, NULL, bottom_row, NULL, legend_bottom, NULL,
nrow=7, rel_heights = c(-0.22,1, -0.42,1,-0.7,1,-0.45))
#ggsave("figures/fig1_example_ecdfs.png", comb_pl, height = 12, width=20, units="cm")
comb_pl
